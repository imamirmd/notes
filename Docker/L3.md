
#### Working with `run`

```shell
sudo docker run [<options>] <repository[:tag]> [<command>]
```

```shell
sudo docker run -it ubuntu:latest /bin/bash
```

 - **`-i`** → keep input open (interactive)
- **`-t`** → allocate a terminal (TTY)

> In a container, **PID 1 belongs to the container’s main process**.

- In **Docker**, it’s usually the **command you run** (e.g. `/bin/bash`, `nginx`)
- In **LXC/system containers**, it’s often an **init system** like `systemd`

```shell
sudo docker run -itd --name ubuntu ubuntu:latest /bin/bash
```

- **`-d`** → runs a container in **detached mode** (or CTRL + PQ).
- **`--name`** → sets a custom, easy-to-use name for a Docker container.

**Note**: CTRL + D causes to exit, and the container stops.

> **container ID** is a unique identifier that Docker assigns to each container.

```shell
sudo docker run --rm busybox ping 8.8.8.8
```

- Runs a temporary the container that executes `ping 8.8.8.8`, and **automatically removes the container** as soon as the command stops (`--rm`).

---
#### Live Restore 

> **Live Restore** is a Docker feature that keeps containers running even if the Docker daemon (`dockerd`) is restarted or upgraded.

| **Enabling live-restore mechanism**

```shell
sudo nano /etc/docker/daemon.json # should be edited dockerd config file
```

add the following value to `daemon.json`

```json
{
	"live-restore": true
}
```

**Note**: Restart docker once for `daemon.json` changes.

```shell
sudo systemctl reload docker
```

```shell
sudo docker info | grep -i "live restore"
# or
sudo docker info --format '{{.LiveRestoreEnabled}}'
```

> **Live Restore works by decoupling container processes from the Docker daemon.**

- Containers are actually run and supervised by **containerd + containerd-shim**, not directly by `dockerd`
- When `dockerd` restarts, **shim keeps the container processes alive**
- After restart, `dockerd` **reconnects to containerd** and regains control

> Containers don’t die because their **parent process is the shim**, not `dockerd`.

> If **`containerd` dies**, **running containers keep running**, but **management is lost temporarily**. 

- You **cannot start/stop/inspect containers**    
- When `containerd` restarts, it **reconnects to existing shims**
- Control is restored without killing containers

> Live Restore only controls what happens when **`dockerd` restarts** (`systemctl restart docker`)

> **Live Restore** only prevents Docker from **intentionally stopping containers during a graceful `dockerd` restart**.

> Daemon crashes (`dockerd` / `containerd`) don’t kill containers unless the **shim or host** dies.

> If **Live Restore is OFF** and you **kill `dockerd` while a container is running**:

- The **container keeps running** (it’s owned by the shim)
- When `dockerd` starts again, it **does NOT reattach** to that running container
- Docker treats the container as **stopped / unknown**
- You usually must **stop and start it manually** to manage it again

> A container’s processes are **normal Linux processes on the host**, just running inside **namespaces**.  So on the Docker host you can see them with tools like `ps` or `top`, but they appear **isolated inside the container** because namespaces hide other processes.

---
### Storage Driver

> **storage driver** is the Docker component that manages how image layers and container filesystems are stored, shared, and written on disk.

```shell
sudo nano /etc/docker/daemon.json
```

```json
{
	"storage-driver": "<driver>"
}
```

```shell
sudo docker info | grep -i "storage driver"
# or
sudo docker info --format '{{.Driver}}'
```

---
#### Creating a new container

> In this case, only the container is **created**, and to run the container, you must use the `docker start` command.

> All parameters that are typically available in `docker run` can usually be used for `docker create` as well.

```shell
sudo docker create <repository[:tag]>
```

